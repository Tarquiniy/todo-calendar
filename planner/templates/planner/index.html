{% extends 'planner/base.html' %}
{% load static %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4 animated-item" style="animation-delay: 0.1s;">
    <div>
      <h1 class="display-5 fw-bold text-gradient">
        <span class="text-primary">üìã</span> –ú–æ–∏ –∑–∞–¥–∞—á–∏
      </h1>
      <p class="text-muted">–í—Å–µ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ</p>
    </div>
    <a href="{% url 'add_note' %}" class="btn btn-primary">
      <i class="bi bi-plus-circle me-2"></i> –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
    </a>
  </div>

  <div class="glass-card p-4 mb-4 animated-item" style="animation-delay: 0.2s;">
    <form method="get" class="row g-3">
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" name="q" value="{{ request.GET.q }}" placeholder="–ü–æ–∏—Å–∫..."
                 class="form-control form-control-lg">
        </div>
      </div>
      <div class="col-md-3">
        <select name="status" class="form-select form-select-lg">
          <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="NEW" {% if request.GET.status == 'NEW' %}selected{% endif %}>üÜï –ù–æ–≤—ã–µ</option>
          <option value="IN_PROGRESS" {% if request.GET.status == 'IN_PROGRESS' %}selected{% endif %}>üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
          <option value="DONE" {% if request.GET.status == 'DONE' %}selected{% endif %}>‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
        </select>
      </div>
      <div class="col-md-3">
        <select name="category" class="form-select form-select-lg">
          <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories %}
            <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary w-100 h-100">
          <i class="bi bi-funnel me-2"></i>–§–∏–ª—å—Ç—Ä
        </button>
      </div>
    </form>
  </div>

  <div class="glass-card p-4 mb-4 animated-item" style="animation-delay: 0.3s;">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex gap-3">
        <div class="d-flex align-items-center">
          <span class="status-badge NEW me-2">
            <i class="bi bi-circle-fill me-1"></i> –ù–æ–≤—ã–µ: {{ new_count }}
          </span>
        </div>
        <div class="d-flex align-items-center">
          <span class="status-badge IN_PROGRESS me-2">
            <i class="bi bi-circle-fill me-1"></i> –í –ø—Ä–æ—Ü–µ—Å—Å–µ: {{ in_progress_count }}
          </span>
        </div>
        <div class="d-flex align-items-center">
          <span class="status-badge DONE">
            <i class="bi bi-circle-fill me-1"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ: {{ done_count }}
          </span>
        </div>
      </div>
      <div class="text-end">
        <div class="progress" style="height: 10px; width: 200px;">
          <div class="progress-bar bg-success" role="progressbar" 
               style="width: {{ progress_percentage }}%;" 
               aria-valuenow="{{ progress_percentage }}" 
               aria-valuemin="0" 
               aria-valuemax="100"></div>
        </div>
        <small class="text-muted">–í—ã–ø–æ–ª–Ω–µ–Ω–æ {{ done_count }} –∏–∑ {{ total_count }} ({{ progress_percentage }}%)</small>
      </div>
    </div>
  </div>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for note in notes %}
    <div class="col animated-item" style="animation-delay: {{ forloop.counter0|divisibleby:2|yesno:'0.3,0.4' }}s">
      <div class="card h-100 shadow-sm card-hover glass-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title fw-bold mb-0">{{ note.title }}</h5>
            <span class="status-badge {{ note.status }}">
              {{ note.get_status_display }}
            </span>
          </div>
          
          <div class="mb-3">
            <p class="card-text">{{ note.content|default:"<em>–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è</em>"|safe }}</p>
          </div>
          
          <div class="mb-3">
            <div class="d-flex gap-2 flex-wrap">
              <span class="badge bg-primary">
                <i class="bi bi-flag me-1"></i>{{ note.get_priority_display }}
              </span>
              {% if note.category %}
                <span class="badge bg-info">
                  <i class="bi bi-tag me-1"></i>{{ note.category.name }}
                </span>
              {% endif %}
            </div>
          </div>
          
          <div class="text-muted small mb-3">
            <div><i class="bi bi-clock me-1"></i> –ù–∞—á–∞–ª–æ: {{ note.start|date:"d.m.Y H:i" }}</div>
            {% if note.end %}
              <div><i class="bi bi-clock me-1"></i> –û–∫–æ–Ω—á–∞–Ω–∏–µ: {{ note.end|date:"d.m.Y H:i" }}</div>
            {% endif %}
          </div>
          
          {% if note.attachment %}
            <a href="{{ note.attachment.url }}" class="btn btn-outline-secondary btn-sm w-100 mb-2">
              <i class="bi bi-paperclip me-1"></i> –í–ª–æ–∂–µ–Ω–∏–µ
            </a>
          {% endif %}
        </div>
        <div class="card-footer bg-transparent d-flex justify-content-between border-0 pt-0">
          <a href="{% url 'complete_note' note.id %}" class="btn btn-sm btn-success rounded-pill">
            <i class="bi bi-check-circle"></i>
          </a>
          <a href="{% url 'edit_note' note.id %}" class="btn btn-sm btn-warning rounded-pill">
            <i class="bi bi-pencil"></i>
          </a>
          <a href="{% url 'delete_note' note.id %}" class="btn btn-sm btn-danger rounded-pill">
            <i class="bi bi-trash"></i>
          </a>
        </div>
      </div>
    </div>
    {% empty %}
      <div class="col-12 animated-item" style="animation-delay: 0.4s">
        <div class="glass-card p-5 text-center">
          <div class="display-1 text-muted mb-3">üôà</div>
          <h3 class="mb-3">–ù–µ—Ç –∑–∞–¥–∞—á –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</h3>
          <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞</p>
          <a href="{% url 'add_note' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
          </a>
        </div>
      </div>
    {% endfor %}
  </div>
  
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ -->
  <div class="d-flex justify-content-between mt-5">
    <div>
      <a href="{% url 'categories' %}" class="btn btn-outline-primary">
        <i class="bi bi-tags me-2"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
      </a>
    </div>
    <div>
      <a href="{% url 'calendar' %}" class="btn btn-primary">
        <i class="bi bi-calendar-week me-2"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
      </a>
    </div>
  </div>
</div>
{% endblock %}